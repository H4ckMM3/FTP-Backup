# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è FTP Backup Plugin

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#–æ–±–∑–æ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
4. [API –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã](#api-–∏-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
5. [–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è](#—Å–∏—Å—Ç–µ–º–∞-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-—Ñ–∞–π–ª–æ–≤)
8. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
9. [–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏](#—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏)
10. [–û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#–æ—Ç–ª–∞–¥–∫–∞-–∏-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
11. [–°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#—Å–æ–≤–µ—Ç—ã-–ø–æ-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
12. [–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è](#–∏–∑–≤–µ—Å—Ç–Ω—ã–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

---

## üèóÔ∏è –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

FTP Backup Plugin –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Sublime Text API                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Commands Layer (–ö–æ–º–∞–Ω–¥—ã Sublime Text)                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ FtpBackupSaveCommand                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ FtpBackupCreateBeforeCommand                          ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ FtpBackupCreateAfterCommand                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ FtpBackupCreateZipCommand                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Business Logic Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ FtpBackupManager                                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ FtpBackupLogger                                       ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Event Listeners                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  UI Layer (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Mini Panel                                            ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Full Interface                                        ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Task Selector                                         ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Settings Panel                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Data Layer (–°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö)                                  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ Configuration Files                                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ File System Operations                                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ Backup Storage                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
2. **–ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö
3. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ FtpBackupManager
4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
5. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
FTP-Backup-main/
‚îú‚îÄ‚îÄ ftp_backup.py                    # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îú‚îÄ‚îÄ ftp_backup_interface.py          # HTTP API –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ ftp_backup_ui.py                 # –ù–∞—Ç–∏–≤–Ω—ã–π UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ ftp_backup_mini_panel.py         # –ú–∏–Ω–∏-–ø–∞–Ω–µ–ª—å (Alt+B)
‚îú‚îÄ‚îÄ ftp_backup_task_selector.py      # –°–µ–ª–µ–∫—Ç–æ—Ä –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ ftp_backup_task_command.py       # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–¥–∞—á–∞–º–∏
‚îú‚îÄ‚îÄ ftp_backup_settings.py           # –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îú‚îÄ‚îÄ ftp_backup.sublime-settings      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îú‚îÄ‚îÄ Default.sublime-commands         # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ Default (Windows).sublime-keymap # –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
‚îú‚îÄ‚îÄ Main.sublime-menu                # –ú–µ–Ω—é –ø–ª–∞–≥–∏–Ω–∞
‚îú‚îÄ‚îÄ fontawesome.js                   # –ò–∫–æ–Ω–∫–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ messages/                        # –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ 1.0.0.txt
‚îÇ   ‚îî‚îÄ‚îÄ install.txt
‚îú‚îÄ‚îÄ README.md                        # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ LICENSE.md                       # –õ–∏—Ü–µ–Ω–∑–∏—è
‚îî‚îÄ‚îÄ DEVELOPER_GUIDE.md              # –≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:

- **`ftp_backup.py`** - —Å–µ—Ä–¥—Ü–µ –ø–ª–∞–≥–∏–Ω–∞, —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
- **`ftp_backup_interface.py`** - HTTP API –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- **`ftp_backup_ui.py`** - –Ω–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Sublime Text
- **`ftp_backup_mini_panel.py`** - –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. FtpBackupManager

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≤—Å–µ–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –±—ç–∫–∞–ø–∞:

```python
class FtpBackupManager:
    def __init__(self, backup_root=None):
        self.backup_root = backup_root
        self.server_backup_map = {}
        self.config_path = os.path.join(backup_root, 'backup_config.json')
        self.folder_mapping_path = os.path.join(backup_root, 'folder_mapping.json')
        self.logger = FtpBackupLogger(backup_root)

    def backup_file(self, file_path, server_name=None, mode=None, task_number=None):
        # –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞
        pass

    def create_backup_zip(self, folder_path, folder_type=None):
        # –°–æ–∑–¥–∞–Ω–∏–µ ZIP-–∞—Ä—Ö–∏–≤–∞
        pass
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

- `backup_file()` - —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ —Ñ–∞–π–ª–∞
- `create_backup_zip()` - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫
- `extract_site_name()` - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞ –∏–∑ –ø—É—Ç–∏
- `_extract_relative_path()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏

### 2. FtpBackupLogger

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```python
class FtpBackupLogger:
    def __init__(self, backup_root):
        log_dir = os.path.join(backup_root, 'logs')
        log_file = os.path.join(log_dir, 'ftp_backup.log')
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

    def debug(self, message):
        # –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

    def error(self, message):
        # –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
```

### 3. –ö–æ–º–∞–Ω–¥—ã Sublime Text

```python
class FtpBackupSaveCommand(sublime_plugin.TextCommand):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –±—ç–∫–∞–ø–æ–º (Ctrl+Shift+R)"""

class FtpBackupCreateBeforeCommand(sublime_plugin.TextCommand):
    """–°–æ–∑–¥–∞–Ω–∏–µ 'before' –±—ç–∫–∞–ø–∞"""

class FtpBackupCreateAfterCommand(sublime_plugin.TextCommand):
    """–°–æ–∑–¥–∞–Ω–∏–µ 'after' –±—ç–∫–∞–ø–∞"""

class FtpBackupCreateZipCommand(sublime_plugin.WindowCommand):
    """–°–æ–∑–¥–∞–Ω–∏–µ ZIP-–∞—Ä—Ö–∏–≤–∞"""
```

---

## üîå API –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### HTTP API (ftp_backup_interface.py)

–ü–ª–∞–≥–∏–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```python
# GET endpoints
/api/get_status              # –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (–∑–∞–¥–∞—á–∞, —Å–µ—Ä–≤–µ—Ä)
/api/get_settings            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
/api/get_recent_backups      # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –±—ç–∫–∞–ø—ã
/api/get_file_versions       # –í–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞
/api/get_file_content        # –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
/api/get_file_metadata       # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞
/api/get_backup_statistics   # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—ç–∫–∞–ø–æ–≤

# POST endpoints
/api/save_settings           # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
/api/restore_file_version    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–∞

# Action endpoints
/api/save                    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –±—ç–∫–∞–ø–æ–º
/api/before_backup           # –°–æ–∑–¥–∞–Ω–∏–µ 'before' –±—ç–∫–∞–ø–∞
/api/after_backup            # –°–æ–∑–¥–∞–Ω–∏–µ 'after' –±—ç–∫–∞–ø–∞
/api/create_zip              # –°–æ–∑–¥–∞–Ω–∏–µ ZIP-–∞—Ä—Ö–∏–≤–∞
/api/change_task             # –°–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏
```

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API:

```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
const status = await ftpBackupAPI.getStatus();

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å –±—ç–∫–∞–ø–æ–º
const result = await ftpBackupAPI.saveWithBackup();

// –°–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏
await ftpBackupAPI.changeTask("task_123");
```

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

```python
# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
CURRENT_TASK_NUMBER = None  # –¢–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏
CURRENT_SERVER = None       # –¢–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä/–ø—Ä–æ–µ–∫—Ç

# –ú–µ—Ç–æ–¥—ã FtpBackupManager
manager = FtpBackupManager(backup_root)
before_path, after_path, site_name = manager.backup_file(
    file_path,
    server_name="my_project",
    mode="before",
    task_number="task_123"
)
```

---

## üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```python
class FtpBackupLogger:
    def __init__(self, backup_root):
        log_dir = os.path.join(backup_root, 'logs')
        os.makedirs(log_dir, exist_ok=True)
        log_file = os.path.join(log_dir, 'ftp_backup.log')

        logging.basicConfig(
            filename=log_file,
            level=logging.DEBUG,
            format='%(asctime)s - %(levelname)s: %(message)s',
            datefmt='%Y-%m-%d %H:%M:%S'
        )
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

- **DEBUG** - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- **INFO** - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ
- **WARNING** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **ERROR** - –æ—à–∏–±–∫–∏ —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–º

### –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

```
2025-01-15 14:30:25 - DEBUG: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FtpBackupManager. –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞: C:\BackUp
2025-01-15 14:30:26 - DEBUG: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞: 15 –∑–∞–ø–∏—Å–µ–π
2025-01-15 14:30:27 - DEBUG: –ò–∑–≤–ª–µ—á–µ–Ω –ø—É—Ç—å —á–µ—Ä–µ–∑ –∫–æ—Ä–Ω–µ–≤—É—é –ø–∞–ø–∫—É www: index.php
2025-01-15 14:30:28 - DEBUG: –°–æ–∑–¥–∞–Ω/–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω –±—ç–∫–∞–ø –≤ C:\BackUp\site\before\index.php
2025-01-15 14:30:29 - ERROR: –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: Permission denied
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥-—Ñ–∞–π–ª**: `{backup_root}/logs/ftp_backup.log`
2. **–í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–∫—É**: –ª–æ–≥–∏ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ DEBUG —É—Ä–æ–≤–µ–Ω—å
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏**: –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–º

---

## ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```python
# –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
backup_config.json      # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—ç–∫–∞–ø–∞—Ö —Ñ–∞–π–ª–æ–≤
folder_mapping.json     # –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω —Å–∞–π—Ç–æ–≤ —Å –ø–∞–ø–∫–∞–º–∏
site_name_mapping.json  # –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—É—Ç–µ–π –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –∏–º–µ–Ω —Å–∞–π—Ç–æ–≤
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ backup_config.json

```json
{
  "relative/path/to/file.php": {
    "first_backup_time": "2025-01-15 14:30:25",
    "last_backup_time": "2025-01-15 15:45:12",
    "site": "my_project",
    "backup_dir": "C:\\BackUp\\my_project\\January 2025\\task_123"
  }
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ folder_mapping.json

```json
{
  "my_project": "my_project_folder",
  "another_site": "another_site_folder"
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ site_name_mapping.json

```json
{
  "C:\\var\\www\\my_project": "my_project",
  "C:\\var\\www\\another_site": "another_site"
}
```

### –ú–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

```python
def _load_config(self):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—ç–∫–∞–ø–æ–≤"""
    if os.path.exists(self.config_path):
        with open(self.config_path, 'r', encoding='utf-8') as f:
            self.server_backup_map = json.load(f)

def _save_config(self):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    with open(self.config_path, 'w', encoding='utf-8') as f:
        json.dump(self.server_backup_map, f, indent=4, ensure_ascii=False)
```

---

## üìÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞

```python
def extract_site_name(self, file_path, prompt_if_failed=True):
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞ –∏–∑ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É"""

    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–º–µ–Ω–∏ —Å–∞–π—Ç–∞
    patterns = [
        r'(?:var\\www\\|www\\|public_html\\|local\\|htdocs\\|home\\)([^\\]+)',
        r'ftp://([^/]+)',
        r'\\([^\\]+)\\(?:www|public_html|httpdocs)\\',
    ]

    # –ü–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
    for pattern in patterns:
        match = re.search(pattern, normalized_path)
        if match:
            return match.group(1)

    # –ó–∞–ø—Ä–æ—Å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if prompt_if_failed:
        return self._prompt_site_name()
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏

```python
def _extract_relative_path(self, file_path):
    """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ —Ñ–∞–π–ª–∞"""

    project_roots = [
        'var\\www\\',
        'www\\',
        'public_html\\',
        'local\\',
        'htdocs\\',
        'home\\'
    ]

    normalized_path = file_path.replace('/', '\\')
    for root in project_roots:
        if root in normalized_path:
            relative_path = normalized_path.split(root, 1)[1]
            return relative_path.replace('\\', '/')

    return os.path.basename(file_path)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –±—ç–∫–∞–ø–∞

```
BackUp/
‚îú‚îÄ‚îÄ site_name/                    # –ò–º—è —Å–∞–π—Ç–∞/–ø—Ä–æ–µ–∫—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ January 2025/            # –ú–µ—Å—è—Ü –∏ –≥–æ–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_123/            # –ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ before/          # –í–µ—Ä—Å–∏—è "–¥–æ" –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ after/           # –í–µ—Ä—Å–∏—è "–ø–æ—Å–ª–µ" –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ backup_site_15.01.2025.14.30.zip
‚îÇ   ‚îî‚îÄ‚îÄ February 2025/
‚îî‚îÄ‚îÄ another_site/
```

### –†–µ–∂–∏–º—ã –±—ç–∫–∞–ø–∞

```python
# –†–µ–∂–∏–º—ã –¥–ª—è –º–µ—Ç–æ–¥–∞ backup_file()
mode = None      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Å–æ–∑–¥–∞–µ—Ç –∏ before, –∏ after)
mode = 'before'  # –¢–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏—è "–¥–æ"
mode = 'after'   # –¢–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏—è "–ø–æ—Å–ª–µ"
```

---

## üé® –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ú–∏–Ω–∏-–ø–∞–Ω–µ–ª—å (Alt+B)

```python
class FtpBackupMiniPanelCommand(sublime_plugin.WindowCommand):
    def run(self):
        # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        items = [
            ["üíæ Save with Backup", "save_with_backup"],
            ["üìÅ Create Before Backup", "create_before_backup"],
            ["üìÅ Create After Backup", "create_after_backup"],
            ["üì¶ Create ZIP Archive", "create_zip_archive"],
            ["üîÑ Change Task", "change_task"],
            ["‚öôÔ∏è Settings", "open_settings"]
        ]

        self.window.show_quick_panel(items, self.on_selected)
```

### –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (Ctrl+Alt+B)

```python
class FtpBackupInterfaceCommand(sublime_plugin.WindowCommand):
    def run(self):
        # –ó–∞–ø—É—Å–∫ –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        self.window.run_command("ftp_backup_ui")
```

### –°–µ–ª–µ–∫—Ç–æ—Ä –∑–∞–¥–∞—á

```python
class FtpBackupTaskSelectorCommand(sublime_plugin.WindowCommand):
    def run(self):
        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–¥–∞—á
        # –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
        # –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
```

### –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫

```python
class FtpBackupSettingsCommand(sublime_plugin.WindowCommand):
    def run(self):
        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
        # –ü—É—Ç—å –∫ –ø–∞–ø–∫–µ –±—ç–∫–∞–ø–æ–≤
        # –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Å—è—á–Ω—ã—Ö –ø–∞–ø–æ–∫
        # –ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

---

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã

1. **–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –∫–æ–º–∞–Ω–¥—ã:**

```python
class FtpBackupCustomCommand(sublime_plugin.TextCommand):
    def run(self, edit):
        file_path = self.view.file_name()
        if not file_path:
            sublime.status_message("No file open")
            return

        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –∑–¥–µ—Å—å
        self.perform_custom_operation(file_path)

    def perform_custom_operation(self, file_path):
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
        pass
```

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ Default.sublime-commands:**

```json
{
  "caption": "FTP Backup: Custom Operation",
  "command": "ftp_backup_custom"
}
```

3. **–î–æ–±–∞–≤—å—Ç–µ –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –≤ Default.sublime-keymap:**

```json
{
  "keys": ["ctrl+shift+c"],
  "command": "ftp_backup_custom"
}
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ FtpBackupManager

```python
class ExtendedFtpBackupManager(FtpBackupManager):
    def __init__(self, backup_root=None):
        super().__init__(backup_root)
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

    def custom_backup_method(self, file_path):
        """–í–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–µ—Ç–æ–¥ –±—ç–∫–∞–ø–∞"""
        # –õ–æ–≥–∏–∫–∞ –≤–∞—à–µ–≥–æ –º–µ—Ç–æ–¥–∞
        pass

    def validate_file(self, file_path):
        """–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –±—ç–∫–∞–ø–æ–º"""
        # –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–π–ª–∞
        return True
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –±—ç–∫–∞–ø–∞

```python
def backup_file(self, file_path, server_name=None, mode=None, task_number=None):
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥...

    if mode == 'custom':
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        custom_backup_path = os.path.join(task_folder, 'custom')
        os.makedirs(custom_backup_path, exist_ok=True)
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞...
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

```python
class ExternalSystemIntegration:
    def __init__(self):
        self.api_key = "your_api_key"
        self.api_url = "https://api.example.com"

    def sync_with_external_system(self, backup_info):
        """–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π"""
        # –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –±—ç–∫–∞–ø–µ
        pass

    def get_external_backups(self, site_name):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –∏–∑ –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã"""
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        pass
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –û—Ç–ª–∞–¥–∫–∞ –≤ Sublime Text

1. **–í–∫–ª—é—á–∏—Ç–µ –æ—Ç–ª–∞–¥–∫—É:**

   ```python
   import logging
   logging.basicConfig(level=logging.DEBUG)
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ console.log:**

   ```python
   print(f"Debug: {variable}")
   sublime.status_message(f"Debug: {variable}")
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥-—Ñ–∞–π–ª—ã:**
   - `{backup_root}/logs/ftp_backup.log`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥

```python
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ Sublime Text
# –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å: View > Show Console

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
sublime.active_window().run_command("ftp_backup_save")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
settings = sublime.load_settings('ftp_backup.sublime-settings')
print(settings.get('backup_root'))
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

```python
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ HTTP API
import requests

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
response = requests.get('http://localhost:8080/api/get_status')
print(response.json())

# –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
response = requests.post('http://localhost:8080/api/save')
print(response.json())
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
def create_test_backup():
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±—ç–∫–∞–ø–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏"""
    test_file = "C:\\var\\www\\test_site\\index.php"
    test_content = "<?php echo 'Hello World'; ?>"

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
    os.makedirs(os.path.dirname(test_file), exist_ok=True)
    with open(test_file, 'w') as f:
        f.write(test_content)

    # –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
    manager = FtpBackupManager("C:\\TestBackup")
    manager.backup_file(test_file, "test_site", "before", "test_task")
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

```python
def check_permissions(path):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–µ"""
    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ
        os.listdir(path)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
        test_file = os.path.join(path, 'test_write.tmp')
        with open(test_file, 'w') as f:
            f.write('test')
        os.remove(test_file)

        return True
    except Exception as e:
        print(f"Permission error: {e}")
        return False
```

---

## ‚ö° –°–æ–≤–µ—Ç—ã –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

```python
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É—Ñ–µ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
def copy_large_file(src, dst, buffer_size=8192):
    """–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π"""
    with open(src, 'rb') as fsrc:
        with open(dst, 'wb') as fdst:
            while True:
                buf = fsrc.read(buffer_size)
                if not buf:
                    break
                fdst.write(buf)
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```python
class CachedBackupManager(FtpBackupManager):
    def __init__(self, backup_root=None):
        super().__init__(backup_root)
        self._config_cache = None
        self._cache_timestamp = 0

    def _load_config(self):
        """–ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
        current_time = time.time()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫—ç—à
        if (self._config_cache is None or
            current_time - self._cache_timestamp > 30):  # 30 —Å–µ–∫—É–Ω–¥

            super()._load_config()
            self._config_cache = self.server_backup_map.copy()
            self._cache_timestamp = current_time
        else:
            self.server_backup_map = self._config_cache.copy()
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
import threading

def async_backup(self, file_path, server_name=None, mode=None, task_number=None):
    """–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞"""
    def backup_worker():
        try:
            self.backup_file(file_path, server_name, mode, task_number)
            sublime.status_message("Backup completed successfully")
        except Exception as e:
            sublime.error_message(f"Backup failed: {str(e)}")

    # –ó–∞–ø—É—Å–∫–∞–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    thread = threading.Thread(target=backup_worker)
    thread.daemon = True
    thread.start()
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤

```python
def find_backup_files_optimized(self, site_name, pattern=None):
    """–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ –±—ç–∫–∞–ø–∞"""
    site_path = os.path.join(self.backup_root, site_name)

    if not os.path.exists(site_path):
        return []

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º os.walk —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
    backup_files = []
    for root, dirs, files in os.walk(site_path):
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–∞–ø–∫–∏ –ª–æ–≥–æ–≤
        dirs[:] = [d for d in dirs if d != 'logs']

        for file in files:
            if pattern is None or pattern in file:
                backup_files.append(os.path.join(root, file))

    return backup_files
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

1. **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**: 100 –ú–ë (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤**: –¥–æ 10,000 –±—ç–∫–∞–ø–æ–≤ –±–µ–∑ –∑–∞–º–µ—Ç–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
3. **–ü—É—Ç–∏**: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—É—Ç–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Sublime Text API

```python
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API Sublime Text
# - –ö–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
# - –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –∏–∑ –∫–æ–º–∞–Ω–¥
# - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Å–∏—Å—Ç–µ–º—ã
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–¥–∏—Ä–æ–≤–æ–∫

```python
def safe_file_operation(file_path, operation):
    """–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö –∫–æ–¥–∏—Ä–æ–≤–æ–∫"""
    encodings = ['utf-8', 'cp1251', 'iso-8859-1', 'utf-16']

    for encoding in encodings:
        try:
            with open(file_path, 'r', encoding=encoding) as f:
                content = f.read()
            return operation(content)
        except UnicodeDecodeError:
            continue

    # –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–∏–Ω–∞—Ä–Ω—ã–π —Ä–µ–∂–∏–º
    with open(file_path, 'rb') as f:
        return operation(f.read().decode('utf-8', errors='replace'))
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã**: –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. **–ú–Ω–æ–≥–æ –±—ç–∫–∞–ø–æ–≤**: –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–æ–π
3. **–°–µ—Ç–µ–≤—ã–µ –ø—É—Ç–∏**: –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–±—Ö–æ–¥—É –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

```python
# –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
def backup_large_file(self, file_path, max_size=50*1024*1024):  # 50MB
    """–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤"""
    if os.path.getsize(file_path) > max_size:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–∂–∞—Ç–∏–µ –∏–ª–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ
        return self.backup_compressed_file(file_path)
    else:
        return self.backup_file(file_path)

# –î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
def get_backups_paginated(self, page=0, page_size=100):
    """–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –±—ç–∫–∞–ø–æ–≤"""
    all_backups = self.get_all_backups()
    start = page * page_size
    end = start + page_size
    return all_backups[start:end]
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Sublime Text API Documentation](https://www.sublimetext.com/docs/api_reference.html)
- [Python File Operations](https://docs.python.org/3/library/os.html)
- [JSON Handling in Python](https://docs.python.org/3/library/json.html)
- [Regular Expressions](https://docs.python.org/3/library/re.html)

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
class FtpBackupCustomBackupCommand(sublime_plugin.TextCommand):
    def run(self, edit):
        file_path = self.view.file_name()
        if not file_path:
            sublime.status_message("No file open")
            return

        # –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        settings = sublime.load_settings('ftp_backup.sublime-settings')
        backup_root = settings.get('backup_root')

        if not backup_root:
            sublime.status_message("Backup root not configured")
            return

        # –°–æ–∑–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä
        manager = FtpBackupManager(backup_root)

        # –í—ã–ø–æ–ª–Ω—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
        try:
            result = manager.custom_backup_operation(file_path)
            sublime.status_message(f"Custom backup completed: {result}")
        except Exception as e:
            sublime.error_message(f"Custom backup failed: {str(e)}")
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

- **Issues**: [GitHub Issues](https://github.com/H4ckMM3/FTP-Backup/issues)
- **Discussions**: [GitHub Discussions](https://github.com/H4ckMM3/FTP-Backup/discussions)
- **Wiki**: [GitHub Wiki](https://github.com/H4ckMM3/FTP-Backup/wiki)

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –∫–æ–¥ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

---

_–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –Ø–Ω–≤–∞—Ä—å 2025_
